---
title: "HW6"
author: "jgn2108"
date: "`r Sys.Date()`"
output: github_document
---

## Set up
```{r setup, include=FALSE}
library(readr)
library(tidyverse)
library(skimr)
library(dplyr)
library(broom)
library(purrr)
library(broom)
library(ggplot2)
library(tidyr)
library(stringr)
```

## Problem 1

Loading data: Washington Post homicide data
```{r}
url <- "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"

# Read the CSV file into a data frame
homicide_data <- read_csv(url)

# View the first few rows of the data
head(homicide_data)
```
Reformat reported_date
```{r}
# Convert numeric date to Date object
homicide_data$reported_date <- as.Date(as.character(homicide_data$reported_date), format = "%Y%m%d")

# Format the date as MM/DD/YYYY
homicide_data$reported_date <- format(homicide_data$reported_date, "%m/%d/%Y")
```
Create first variable
```{r}
# Create city_state variable
homicide_data <- mutate(homicide_data, city_state = paste(city, state, sep = ", "))
homicide_data
```

Create a binary factor variable re: disposition
```{r}
homicide_data <- homicide_data %>%
  mutate(disposition = relevel(factor(disposition, levels = c("Closed by arrest", "Closed without arrest")),
                               ref = "Closed by arrest"))
str(homicide_data)
```

```{r}
homicide_data <- homicide_data %>%
  mutate(disposition2 = factor(ifelse(disposition == "Closed by arrest", "solved", "unsolved"),
                               levels = c("solved", "unsolved"),
                               exclude = NULL))
homicide_data
```

Omit rows with the following city_state:"Dallas, TX"; "Phoenix, AZ"; "Kansas City, MO"; and "Tulsa, AL" 
```{r}
homicide_data <- homicide_data %>%
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")))
homicide_data #from 52179 observations, down to 48507
```

Make victim_age numeric
```{r}
homicide_data <- homicide_data %>%
  mutate(victim_age = as.numeric(victim_age))
str(homicide_data)
```
Make victim_race a factor variable
```{r}
homicide_data <- homicide_data %>%
  mutate(victim_race = factor(victim_race, 
                              levels = c("Hispanic", "White", "Black", "Asian", "Other"),
                              labels = c(1, 2, 3, 4, 5),
                              exclude = NULL))
str(homicide_data)
```

Filter out all victim_race that are not "White" or "Black"
```{r}
homicide_data_filtered <- homicide_data %>%
  filter(victim_race %in% c(2, 3))
str(homicide_data_filtered) #from 52179 rows, now n=39693
```

Fit a logistic regression model, outcome=disposition2
```{r}
model <- glm(disposition2 ~ victim_age + victim_sex + victim_race, data = homicide_data_filtered, family = "binomial")
summary(model) #model summary
```


